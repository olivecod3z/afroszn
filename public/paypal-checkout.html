<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayPal Checkout - Afro Szn</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/checkout-mobile.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
</head>
<body class="checkout-body">
    <!-- Header -->
    <header class="checkout-header">
        <button class="back-btn" onclick="window.history.back()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
        </button>
        <h1 class="checkout-title">PayPal Checkout</h1>
        <div style="width: 24px;"></div> <!-- Spacer -->
    </header>

    <!-- Content -->
    <main class="checkout-main">
        <!-- Event Info -->
        <div class="paypal-event-info">
            <h2 id="eventName" class="event-name">AFRO SEASON VOLUME 4</h2>
            <p id="eventDate" class="event-date">Friday, October 2025</p>
        </div>

        <!-- Order Summary -->
        <div class="order-summary-card">
            <h3>Order Summary</h3>
            <div class="order-line">
                <span id="orderDescription">1 x Early Bird Ticket</span>
                <span id="orderAmount">$25.00</span>
            </div>
            <div class="order-total-line">
                <span>Total</span>
                <span id="totalAmount">$25.00</span>
            </div>
        </div>

        <!-- Customer Info -->
        <div class="customer-info-card">
            <h3>Customer Information</h3>
            <p id="customerName">John Smith</p>
            <p id="customerEmail">john@email.com</p>
        </div>

        <!-- PayPal Button Container -->
        <div id="paypal-button-container"></div>

        <!-- Loading State -->
        <div id="loading" style="display: none; text-align: center; margin-top: 20px;">
            <p style="color: #9AA4B2;">Processing payment...</p>
        </div>

        <!-- Error Message -->
        <div id="error-message" style="display: none; margin-top: 20px; padding: 16px; background: #ff000020; border: 1px solid #ff0000; border-radius: 8px; color: #ff6b6b;">
            <p id="error-text">Payment failed. Please try again.</p>
        </div>
    </main>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AWPE9j4eLjsg-JiO2cH-Gm79bhfKESA-HyqdE94q3M9uFNA9DfFqEvfKMNeZWx-AI9EJnpA6wi1MWOye&currency=USD"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Get order data from sessionStorage
        const ticketData = sessionStorage.getItem('ticketData');
        let orderData = {};
        
        if (ticketData) {
            orderData = JSON.parse(ticketData);
        } else {
            // Fallback
            orderData = {
                eventName: sessionStorage.getItem('eventName') || 'AFRO SEASON VOLUME 4',
                eventDate: sessionStorage.getItem('eventDate') || 'Friday, October 2025',
                ticketType: sessionStorage.getItem('ticketType') || 'Early Bird',
                quantity: parseInt(sessionStorage.getItem('ticketQuantity')) || 1,
                basePrice: parseFloat(sessionStorage.getItem('basePrice')) || 25,
                price: parseFloat(sessionStorage.getItem('ticketPrice')) || 25
            };
        }

        // Get customer info
        const firstName = sessionStorage.getItem('firstName') || '';
        const lastName = sessionStorage.getItem('lastName') || '';
        const email = sessionStorage.getItem('buyerEmail') || '';

        // Update page with order details
        document.getElementById('eventName').textContent = orderData.eventName || 'Event';
        document.getElementById('eventDate').textContent = orderData.eventDate || '';
        document.getElementById('orderDescription').textContent = `${orderData.quantity} x ${orderData.ticketType} Ticket${orderData.quantity > 1 ? 's' : ''}`;
        document.getElementById('orderAmount').textContent = `$${orderData.price.toFixed(2)}`;
        document.getElementById('totalAmount').textContent = `$${orderData.price.toFixed(2)}`;
        document.getElementById('customerName').textContent = `${firstName} ${lastName}`.trim() || 'Guest';
        document.getElementById('customerEmail').textContent = email || '';

        // Initialize PayPal Button
        paypal.Buttons({
            style: {
                layout: 'vertical',
                color: 'gold',
                shape: 'rect',
                label: 'paypal',
                height: 50
            },
            
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        description: `${orderData.eventName} - ${orderData.ticketType} (${orderData.quantity}x)`,
                        amount: {
                            currency_code: 'USD',
                            value: orderData.price.toFixed(2)
                        },
                        custom_id: `${orderData.eventName}-${Date.now()}` // Track this order
                    }],
                    payer: {
                        name: {
                            given_name: firstName,
                            surname: lastName
                        },
                        email_address: email
                    }
                });
            },
            
            onApprove: function(data, actions) {
                // Show loading
                document.getElementById('loading').style.display = 'block';
                document.getElementById('paypal-button-container').style.display = 'none';
                
                return actions.order.capture().then(function(details) {
                    console.log('Payment successful!', details);
                    
                    // Store transaction details
                    sessionStorage.setItem('paypalTransactionId', details.id);
                    sessionStorage.setItem('paypalPayerEmail', details.payer.email_address);
                    sessionStorage.setItem('paypalPayerName', details.payer.name.given_name + ' ' + details.payer.name.surname);
                    
                    // Redirect to success page
                    window.location.href = 'success.html?payment=paypal';
                });
            },
            
            onError: function(err) {
                console.error('PayPal error:', err);
                
                // Show error message
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-text').textContent = 'Payment failed. Please try again or contact support.';
                
                // Show button again
                setTimeout(() => {
                    document.getElementById('paypal-button-container').style.display = 'block';
                    document.getElementById('error-message').style.display = 'none';
                }, 5000);
            },
            
            onCancel: function(data) {
                console.log('Payment cancelled by user');
                alert('Payment cancelled. You can try again when ready.');
            }
        }).render('#paypal-button-container');
    });
    </script>

    <style>
    /* Additional Styles for PayPal Checkout */
    .paypal-event-info {
        text-align: center;
        margin-bottom: 32px;
    }

    .event-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: white;
        margin: 0 0 8px 0;
    }

    .event-date {
        font-size: 0.9rem;
        color: #9AA4B2;
        margin: 0;
    }

    .order-summary-card,
    .customer-info-card {
        background: hsl(220, 18%, 10% / 0.5);
        border: 1px solid #2a2a2d;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
    }

    .order-summary-card h3,
    .customer-info-card h3 {
        font-size: 1rem;
        font-weight: 600;
        color: white;
        margin: 0 0 16px 0;
    }

    .order-line {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        color: #9AA4B2;
        border-bottom: 1px solid #2a2a2d;
    }

    .order-total-line {
        display: flex;
        justify-content: space-between;
        padding-top: 16px;
        font-size: 1.25rem;
        font-weight: 700;
        color: white;
    }

    .customer-info-card p {
        margin: 8px 0;
        color: #9AA4B2;
    }

    #paypal-button-container {
        margin-top: 32px;
    }
    </style>
</body>
</html>